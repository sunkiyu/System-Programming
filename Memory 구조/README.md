참조 : 뇌를 자극하는 윈도우즈 시스템 프로그래밍
# Memory 구조 

## 메모리 계층
* 개발자에게 컴퓨터에서 가장 중요한 부분은 메모리    
* 제한된 환경에서 가급적 높은 성능을 낼 수 있도록 하기 위해서는 메모리 특성을 잘 파악해야함   

## 메모리 범위와 종류
* 보통 메모리라고 하면 메인 메모리인 램을 생각   
* 램이 사용되는 메인 메모리 이외에도 메모리라 불릴 수 잇는 요소들이 많다.   
* 컴퓨터 구성 요소 중 임시적이든 영구적이든 저장 기능이 있다면 메모리 범위에 포함됨   

## 메인 메모리
* 가장 먼저 떠올릴 수 있는 것은 메인 메모리인 램   
* 정확히 말하면 D램 계열의 메모리    
* 메인 메모리가 반드리 램일 필요는 없다. 따러서 메인 메모리== 램이라는 등호관계는 성립하지 않는다.   
* 그러나, 거의 모든 컴퓨터가 메인 메모리로 램을 사용하므로 메인 메모리와 램을 동일한 의미로 사용    

## 레지스터
* 레지스터도 당연 메모리    
* CPU안에 내장되어 있어 연산을 위한 저장소 제공    

## 캐쉬
* 캐쉬는 D램보다 빠른 S램으로 구성     
* 램이라는 단어는 메인 메모리를 의미하는 용도로 사용되므로 캐쉬 메모리는 그냥 캐쉬로 표현    
* 캐쉬는 CPU와 램 사이에서 중간 저장소 역할을 하는 메모리, 요즘은 캐쉬가 CPU에 내장되었다고 표현하기도 함.    
* 캐쉬 메모리는 원래 CPU의 일부로 존재하는 메모리의 개념은 아님     
* CPU에 근접해있는 메모리 개념     
* CPU 일부로 존재하는 메모리는 레지스터     

## 하드디스크와 이외의 저장 장치들
* 하드디스크도 당연 메모리    
* 그 밖에 SD카드, CD-ROM과 같은 I/O 장치들도 메모리에 해당    

##### "프로그래머가 개발하는 데 있어서 항상 염두해 두어야 하는 가장 중요한 요소는 메모리이다."
##### "프로그래머는 레지스터, 캐쉬, 메인메모리, 하드디스크 뿐만 아니라 그 밖의 I/O 장치들과의 입/출력 타이밍 및 대기 시간 등을 가장 중요한 요소로 생각하고 항상 고민해야 한다."

## 메모리 계층 구조
* 프로그램이 실행되는 동안 메모리가 하는 역할은 데이터 입/출력이다.   
* 따라서, 기본적인 역할은 모든 메모리가 동일   
* 그 대상이 레지스터건, 하드디스크이건, 모두 동일   
* 그렇다면 차이점은? -> CPU를 기준으로 얼마나 멀리 떨어져 있느냐?   
* 레지스터는 가깝다 못해 CPU 안에 존재   
* 그 다음으로 가까운건 캐쉬 메모리   
* 그 다음 메인 메모리   
* 가장 멀리 떨어져 있는건 하드디스크   
* CPU와 가까울수록 빠르고 멀수록 느림   
* CPU의 레지스터 접근은 별다른 절차 필요없음    
* 메인 메모리 접근 위해서는 복잡한 과정 거침     
* 대표적인 것이 버스 인터페이스 컨트롤    
* 데이터를 입력 및 출력하기 위해서 메모리 버스를 거쳐야 하기 때문에 그만큼 더 느림    

## 피라미드 구조를 보면 가장 위쪽에 있는 것이 레지스터
* 차지하고 있는 크기가 가장 작지만 가장 빠름    
* 그 다음 L1 캐쉬와 L2 캐쉬가 존재   
* 둘 다 캐쉬라는 점에 있어 동일     
* L1 캐쉬가 CPU에 보다 근접해있다고 생각하면 됨. 그리고 아래 메인 메모리가 존재.    
* 캐쉬보다는 크지만 상대적으로 느림     
* 가장 하단에는 하드디스크가 존재. 가장 크지만 가장 느림    

## 각 메모리의 역할
* 하드디스크에 있는 내용은 프로그램 실행을 위해 메인 메모리로 이동    
* 메인 메모리에 있는 데이터 일부도 실행을 위해 L2캐쉬로 이동    
* L2 캐쉬에 있는 데이터 일부는 L1 캐쉬로 이동, L1 캐쉬에 있는 데이터에서 연산에 필요한 데이터가 레지스터로 이동   
* 즉, 모든 메모리의 역할이 피라미드 구조에서 자기보다 아래있는 메모리를 캐쉬하기 위해 존재하는 것으로 이해해야함   
* 캐쉬하다 -> 자주 사용되는 메모리의 일부를 저장해서 속도를 향상시키는 것을 의미     
* 역순으로 살펴보자   
* 연산에 필요한 데이터가 레지스터에 없으면 L1캐쉬 확인, L1에도 없으면 L2캐쉬 확인, L2에도 없으면 메인 메모리를 확인, 그래도 없으면 하드디스크를 확인   
* 하드디스크->메인 메모리->L2->L1->레지스터 순으로 이동. 데이터의 이동이 심함    
* 피라미드 구조 맨 아래 하드디스크 접근 빈도수가 총 메모리 접근 빈도수의 반만 차지해도 상당히 느려짐   
* 연산에 필요한 데이터가 캐쉬 메모리에 존재할 확률이 아주 높다   
* 메인 메모리를 제외한 L1캐쉬와 L2 캐쉬에 연산에 필요한 데이터가 존재할 확률이 90% 이상   
* 메인 메모리까지 생각하면 하드디스크에서 데이터를 읽어들이는 빈도수는 전체 메모리 접근 빈도수의 몇 퍼센트도 되지 않는다는 뜻   




